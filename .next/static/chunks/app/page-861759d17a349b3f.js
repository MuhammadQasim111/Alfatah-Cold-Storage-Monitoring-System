(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5433:function(e,t,s){Promise.resolve().then(s.bind(s,4681))},4681:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var l=s(7437),r=s(2265),a=e=>{let{name:t,type:s,temperature:r,humidity:a,lastUpdated:i,status:n,onClick:d,isSelected:o}=e;return(0,l.jsxs)("div",{onClick:d,className:"p-6 rounded-xl border-2 transition-all cursor-pointer shadow-sm hover:shadow-md\n        ".concat(o?"border-blue-500 ring-2 ring-blue-100":"border-slate-100 bg-white","\n      "),children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold text-lg text-slate-800",children:t}),(0,l.jsx)("p",{className:"text-sm text-slate-500",children:s})]}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-bold border ".concat((e=>{switch(e){case"OK":return"bg-green-100 text-green-800 border-green-200";case"WARNING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"CRITICAL":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(n)),children:n})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"Temp"}),(0,l.jsx)("p",{className:"text-2xl font-mono font-semibold ".concat((r||0)>10?"text-red-600":"text-slate-700"),children:"number"==typeof r?"".concat(r.toFixed(1),"\xb0C"):"--"})]}),(0,l.jsxs)("div",{className:"bg-slate-50 p-3 rounded-lg",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"Humidity"}),(0,l.jsx)("p",{className:"text-2xl font-mono font-semibold text-blue-600",children:"number"==typeof a?"".concat(a.toFixed(1),"%"):"--"})]})]}),(0,l.jsx)("div",{className:"mt-4 text-right",children:(0,l.jsxs)("p",{className:"text-xs text-slate-400",children:["Last updated: ",i?new Date(i).toLocaleTimeString():"Never"]})})]})},i=s(4084),n=s(6705);s(2097),i.kL.register(i.uw,i.f$,i.od,i.jn,i.Dx,i.u,i.De,i.FB);var d=e=>{let{unitId:t,data:s,unitName:r}=e,a=[...s].sort((e,t)=>new Date(e.ts).getTime()-new Date(t.ts).getTime()),i={labels:a.map(e=>new Date(e.ts)),datasets:[{label:"Temperature (\xb0C)",data:a.map(e=>e.temperature),borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.5)",yAxisID:"y",tension:.3,pointRadius:2},{label:"Humidity (%)",data:a.map(e=>e.humidity),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.5)",yAxisID:"y1",tension:.3,pointRadius:2}]};return(0,l.jsx)("div",{className:"h-[400px] w-full bg-white p-4 rounded-xl shadow-sm border border-slate-100",children:(0,l.jsx)(n.x1,{options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index"},plugins:{title:{display:!0,text:"".concat(r," - 24 Hour History")},tooltip:{mode:"index",intersect:!1}},scales:{x:{type:"time",time:{unit:"hour",displayFormats:{hour:"HH:mm"}},title:{display:!0,text:"Time"}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Temp (\xb0C)"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},title:{display:!0,text:"Humidity (%)"}}}},data:i})})},o=e=>{let{alerts:t}=e,s=Array.isArray(t)?t:[];return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden h-[400px] flex flex-col",children:[(0,l.jsxs)("div",{className:"p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center",children:[(0,l.jsx)("h2",{className:"font-bold text-slate-700",children:"System Alerts"}),(0,l.jsxs)("span",{className:"bg-red-100 text-red-700 text-xs px-2 py-1 rounded-full",children:[s.filter(e=>!e.resolved).length," Active"]})]}),(0,l.jsx)("div",{className:"overflow-y-auto flex-1 p-0",children:0===s.length?(0,l.jsx)("div",{className:"p-8 text-center text-slate-400",children:"No active alerts. System healthy."}):(0,l.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,l.jsx)("thead",{className:"bg-slate-50 text-slate-500 uppercase text-xs sticky top-0",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3",children:"Time"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"Unit"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"Severity"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"Message"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:s.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,l.jsx)("td",{className:"px-4 py-3 text-slate-500 whitespace-nowrap",children:new Date(e.ts).toLocaleTimeString()}),(0,l.jsxs)("td",{className:"px-4 py-3 font-medium",children:["Unit ",e.unit_id]}),(0,l.jsx)("td",{className:"px-4 py-3",children:(0,l.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-semibold uppercase\n                      ".concat("critical"===e.severity?"bg-red-100 text-red-700":"warning"===e.severity?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700","\n                    "),children:e.severity})}),(0,l.jsx)("td",{className:"px-4 py-3 text-slate-700",children:e.message})]},t))})]})})]})},c=s(8108),x=s(5566);let u=()=>{let e=x.env.NEXT_PUBLIC_HIVEMQ_WSS_URL||"wss://2faf87f825a94c9f9f4a0db4f9569ab6.s1.eu.hivemq.cloud:8884/mqtt",t=x.env.NEXT_PUBLIC_HIVEMQ_USER||"hivemq.webclient.1764417700877",s=x.env.NEXT_PUBLIC_HIVEMQ_PASS||"Tm1,0S5oP.4x<YE#hkGy";if(console.log("MQTT URL:",e),!e)throw Error("MQTT Broker URL not defined in env");let l=c.Z.connect(e,{username:t,password:s,clientId:"web_client_".concat(Math.random().toString(16).slice(2,10)),clean:!0,connectTimeout:4e3});return l.on("connect",()=>{console.log("Connected to HiveMQ Cloud via WSS")}),l.on("error",e=>{console.error("MQTT Connection Error:",e)}),l};function m(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)(1),[n,c]=(0,r.useState)({}),[x,m]=(0,r.useState)([]),[h,p]=(0,r.useState)([]),[g,b]=(0,r.useState)("realtime"),[y,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{fetch("/api/storage-units").then(e=>e.json()).then(e=>t(Array.isArray(e)?e:[])).catch(e=>{console.error("Failed to fetch units:",e),t([])}),fetch("/api/alerts").then(e=>e.json()).then(e=>p(Array.isArray(e)?e:[])).catch(e=>{console.error("Failed to fetch alerts:",e),p([])}),fetch("/api/readings/latest").then(e=>e.json()).then(e=>{let t={};e.forEach(e=>t[e.unit_id]=e),c(t)}).catch(console.error)},[]),(0,r.useEffect)(()=>{let e=u();return e.subscribe("coldstorage/+/readings"),e.subscribe("coldstorage/alerts"),e.on("message",(e,t)=>{let s=JSON.parse(t.toString());e.includes("/readings")?c(e=>({...e,[s.unit_id]:{unit_id:s.unit_id,temperature:s.temperature,humidity:s.humidity,ts:s.timestamp||s.ts||new Date().toISOString()}})):"coldstorage/alerts"===e&&p(e=>[s,...e])}),()=>{e.end()}},[]);let j=(0,r.useCallback)(async e=>{f(!0);try{let t=await fetch("/api/readings/history?unit_id=".concat(e,"&hours=24")),s=await t.json();m(s)}catch(e){console.error(e)}finally{f(!1)}},[]);(0,r.useEffect)(()=>{j(s)},[s,j]);let v=(e,t)=>{if(void 0===t)return"OFFLINE";let s=h.find(t=>t.unit_id===e&&!t.resolved);return(null==s?void 0:s.severity)==="critical"?"CRITICAL":(null==s?void 0:s.severity)==="warning"?"WARNING":"OK"},N=e.find(e=>e.unit_id===s);return(0,l.jsxs)("main",{className:"min-h-screen p-8 max-w-7xl mx-auto",children:[(0,l.jsxs)("header",{className:"mb-8 flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Cold Storage Monitor"}),(0,l.jsx)("p",{className:"text-slate-500",children:"Real-time Environmental Tracking System"})]}),(0,l.jsx)("div",{className:"flex gap-4",children:(0,l.jsxs)("div",{className:"flex bg-slate-100 p-1 rounded-lg",children:[(0,l.jsx)("button",{onClick:()=>b("realtime"),className:"px-4 py-2 text-sm font-medium rounded-md transition-all ".concat("realtime"===g?"bg-white shadow text-slate-800":"text-slate-500"),children:"Real-time"}),(0,l.jsx)("button",{onClick:()=>b("historical"),className:"px-4 py-2 text-sm font-medium rounded-md transition-all ".concat("historical"===g?"bg-white shadow text-slate-800":"text-slate-500"),children:"Historical"})]})})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:e.map(e=>{var t,r,d;let o=n[e.unit_id];return(0,l.jsx)(a,{unitId:e.unit_id,name:e.name,type:e.product_type,temperature:null!==(t=null==o?void 0:o.temperature)&&void 0!==t?t:null,humidity:null!==(r=null==o?void 0:o.humidity)&&void 0!==r?r:null,lastUpdated:null!==(d=null==o?void 0:o.ts)&&void 0!==d?d:null,status:v(e.unit_id,null==o?void 0:o.temperature),isSelected:s===e.unit_id,onClick:()=>i(e.unit_id)},e.unit_id)})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[N&&(0,l.jsx)(d,{unitId:s,unitName:N.name,data:"realtime"===g?[...x,n[s]].filter(Boolean):x}),(0,l.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 text-sm text-blue-800",children:[(0,l.jsx)("strong",{children:"Simulation Info:"})," To see live data, run the Python scripts provided in the repository.",(0,l.jsxs)("ul",{className:"list-disc ml-5 mt-2",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"python scripts/mqtt_publisher.py"})," (Updates MQTT/Live Cards)"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"python scripts/http_logger.py"})," (Updates Database/History)"]})]})]})]}),(0,l.jsx)("div",{className:"lg:col-span-1",children:(0,l.jsx)(o,{alerts:h})})]})]})}}},function(e){e.O(0,[674,793,371,971,117,744],function(){return e(e.s=5433)}),_N_E=e.O()}]);